commit 670ac119eab14a32abd736ce986674e348f33c3c
Author: Thomas Debesse <dev@illwieckz.net>
Date:   Thu Oct 20 18:54:53 2022 +0200

    patch: luxmark3/luxmark3-luxcore-optionally-prefer-bvh.patch

diff --git a/src/luxrays/idevices/openclidevice.cpp b/src/luxrays/idevices/openclidevice.cpp
index ecbb7d41b..b8b23bbf3 100644
--- a/src/luxrays/idevices/openclidevice.cpp
+++ b/src/luxrays/idevices/openclidevice.cpp
@@ -235,8 +235,11 @@ void OpenCLIntersectionDevice::SetDataSet(DataSet *newDataSet) {
 		if (accelType != ACCEL_AUTO) {
 			accel = dataSet->GetAccelerator(accelType);
 		} else {
+			const char* env_prefer_bvh = getenv("LUXCORE_PREFER_BVH");
+			bool prefer_bvh = (env_prefer_bvh != nullptr && strlen(env_prefer_bvh) != 0);
+
 			// Check if the OpenCL device prefer float4 or float1
-			if (deviceDesc->GetNativeVectorWidthFloat() >= 4) {
+			if (!prefer_bvh && deviceDesc->GetNativeVectorWidthFloat() >= 4) {
 				// The device prefers float4
 				if (dataSet->RequiresInstanceSupport() || dataSet->RequiresMotionBlurSupport()) {
 					accel = dataSet->GetAccelerator(ACCEL_MQBVH);
